{% extends "base.html" %}
{% block title %}Sign up{% endblock %}

{% block content %}
<div class="min-h-[80vh] flex items-center justify-center px-4">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-sm p-6">
    <h1 class="text-2xl font-semibold">Create account</h1>
    <p class="text-gray-500 mt-1">It’s quick and free.</p>

    <!-- Flash messages -->
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        <ul class="mt-4 space-y-2">
          {% for cat, msg in msgs %}
            <li class="rounded-xl px-3 py-2 text-sm border
                       {% if cat == 'error' %} bg-red-50 text-red-700 border-red-200
                       {% elif cat == 'info' %} bg-blue-50 text-blue-700 border-blue-200
                       {% else %} bg-gray-50 text-gray-700 border-gray-200 {% endif %}">
              {{ msg }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Signup form -->
    <form id="signupForm" action="{{ url_for('signup_post') }}" method="post" class="mt-6 space-y-4" novalidate>
      <div>
        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
        <input id="username" name="username" type="text" required minlength="3" autocomplete="username"
               class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300" />
      </div>

      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input id="email" name="email" type="email" required autocomplete="email"
               class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300" />
      </div>

      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <input id="password" name="password" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300" />
        <p id="hint" class="text-xs text-gray-500 mt-1">Min 6 chars. Add numbers/uppercase/symbols for strength.</p>
      </div>

      <div>
        <label for="confirm" class="block text-sm font-medium text-gray-700 mb-1">Confirm password</label>
        <input id="confirm" name="confirm" type="password" required minlength="6" autocomplete="new-password"
               class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-300" />
      </div>

      <button id="submitBtn" type="submit"
              class="w-full px-4 py-2 bg-green-500 text-white font-medium rounded-xl shadow hover:shadow-md transition">
        Create account
      </button>
    </form>

    <p class="text-sm text-gray-500 mt-4 text-center">
      Already have an account?
      <a href="{{ url_for('login') }}" class="text-green-600 hover:underline">Login</a>
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const form = document.getElementById('signupForm');
    const email = document.getElementById('email');
    const pwd = document.getElementById('password');
    const cfm = document.getElementById('confirm');
    const hint = document.getElementById('hint');
    const submitBtn = document.getElementById('submitBtn');

    function strength(p){
      let s=0;
      if(p.length>=8) s++;
      if(/[0-9]/.test(p)) s++;
      if(/[A-Z]/.test(p)) s++;
      if(/[^A-Za-z0-9]/.test(p)) s++;
      return s;
    }

    pwd.addEventListener('input', ()=>{
      const s = strength(pwd.value);
      hint.textContent = s>=3 ? "Good password ✅" : "Weak — add numbers/uppercase/symbols";
    });

    form.addEventListener('submit', (e)=>{
      if (email.value) email.value = email.value.trim().toLowerCase();

      if(pwd.value !== cfm.value){
        e.preventDefault();
        alert("Passwords do not match");
        return;
      }

      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)){
        e.preventDefault();
        alert("Please enter a valid email address");
        email.focus();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Creating…";
    });
  })();
</script>
{% endblock %}