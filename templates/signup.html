{% extends "base.html" %}
{% block title %}Sign up{% endblock %}

{% block content %}
<!-- Page background is inherited from base; this centers the auth card like the login page -->
<div style="min-height:70vh;display:grid;place-items:center;padding:28px 16px">

  <!-- Top “tab” like the login screen -->
  <div aria-hidden="true"
       style="width:220px;height:44px;border-radius:12px;
              background:linear-gradient(180deg,#e6a98f,#c7886b);
              box-shadow:0 10px 24px rgba(0,0,0,.18);
              margin:0 auto -22px auto;position:relative;z-index:2">
  </div>

  <!-- Auth card -->
  <div style="
      width:min(720px,100%);
      background:#212728;            /* same dark panel as login */
      color:#f4f6f7;
      border-radius:18px;
      box-shadow:
        0 24px 48px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.03);
      padding:28px 22px 24px 22px;
  ">
    <h1 style="margin:10px 6px 18px;font-size:28px;letter-spacing:.2px">Create account</h1>

    <!-- Flash messages -->
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        <ul style="list-style:none;margin:0 0 16px;padding:0;display:grid;gap:10px">
          {% for cat, m in msgs %}
            <li style="
              padding:10px 12px;border-radius:12px;font-size:14px;
              border:1px solid {{ 'rgba(243,214,214,.7)' if cat=='error' else 'rgba(140,193,240,.6)' }};
              background:{{ '#3a2424' if cat=='error' else '#233340' }};
              color:{{ '#ffd7d7' if cat=='error' else '#cfeaff' }};
            ">{{ m }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Form -->
    <form id="form" method="post" action="{{ url_for('signup_post') }}"
          style="display:grid;gap:14px">

      <!-- Username -->
      <div>
        <label for="username" style="display:block;font-size:14px;opacity:.9;margin:0 6px 6px">Username</label>
        <input id="username" name="username" required minlength="3" autocomplete="username"
               style="
                 width:100%;height:44px;border-radius:10px;
                 border:1px solid #3b4244;background:#2a3031;color:#e9eef0;
                 padding:0 12px;outline:none;
               "
               onfocus="this.style.borderColor='#6a7cff'"
               onblur="this.style.borderColor='#3b4244'">
      </div>

      <!-- Email -->
      <div>
        <label for="email" style="display:block;font-size:14px;opacity:.9;margin:0 6px 6px">Email</label>
        <input id="email" name="email" type="email" required autocomplete="email" placeholder="you@example.com"
               style="
                 width:100%;height:44px;border-radius:10px;
                 border:1px solid #3b4244;background:#2a3031;color:#e9eef0;
                 padding:0 12px;outline:none;
               "
               onfocus="this.style.borderColor='#6a7cff'"
               onblur="this.style.borderColor='#3b4244'">
      </div>

      <!-- Password -->
      <div>
        <label for="password" style="display:block;font-size:14px;opacity:.9;margin:0 6px 6px">Password</label>
        <input id="password" name="password" type="password" required minlength="6" autocomplete="new-password"
               style="
                 width:100%;height:44px;border-radius:10px;
                 border:1px solid #3b4244;background:#2a3031;color:#e9eef0;
                 padding:0 12px;outline:none;
               "
               onfocus="this.style.borderColor='#6a7cff'"
               onblur="this.style.borderColor='#3b4244'">
        <div id="hint" style="font-size:12px;opacity:.75;margin:6px 6px 0">Min 6 chars. Add numbers/uppercase/symbols for strength.</div>
      </div>

      <!-- Confirm Password -->
      <div>
        <label for="confirm" style="display:block;font-size:14px;opacity:.9;margin:0 6px 6px">Confirm password</label>
        <input id="confirm" name="confirm" type="password" required minlength="6" autocomplete="new-password"
               style="
                 width:100%;height:44px;border-radius:10px;
                 border:1px solid #3b4244;background:#2a3031;color:#e9eef0;
                 padding:0 12px;outline:none;
               "
               onfocus="this.style.borderColor='#6a7cff'"
               onblur="this.style.borderColor='#3b4244'">
      </div>

      <!-- Submit row -->
      <div style="display:flex;align-items:center;gap:12px;margin-top:6px">
        <button id="submitBtn" type="submit"
                style="
                  height:44px;padding:0 16px;border:0;border-radius:10px;cursor:pointer;
                  background:#10a37f;color:#0b1d17;font-weight:700;
                  box-shadow:0 8px 18px rgba(16,163,127,.28);
                ">
          Create account
        </button>
        <div style="font-size:14px;opacity:.85">
          Already have an account?
          <a href="{{ url_for('login') }}" style="color:#c9d6ff;text-decoration:underline;">Login</a>
        </div>
      </div>
    </form>
  </div><!-- /card -->
</div>
{% endblock %}

{% block scripts %}
<script>
const form = document.getElementById('form');
const email = document.getElementById('email');
const username = document.getElementById('username');
const pwd = document.getElementById('password');
const cfm = document.getElementById('confirm');
const hint = document.getElementById('hint');
const submitBtn = document.getElementById('submitBtn');

function strength(p){
  let s=0;
  if(p.length>=8) s++;
  if(/[0-9]/.test(p)) s++;
  if(/[A-Z]/.test(p)) s++;
  if(/[^A-Za-z0-9]/.test(p)) s++;
  return s;
}

pwd.addEventListener('input', ()=>{
  const s = strength(pwd.value);
  hint.textContent = s>=3 ? "Good password ✅" : "Weak — add numbers/uppercase/symbols";
});

form.addEventListener('submit', (e)=>{
  // normalize inputs
  if (email.value) email.value = email.value.trim().toLowerCase();
  if (username.value) username.value = username.value.trim();

  if(pwd.value !== cfm.value){
    e.preventDefault();
    alert("Passwords do not match");
    return;
  }

  // basic email check
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)){
    e.preventDefault();
    alert("Please enter a valid email address");
    email.focus();
    return;
  }

  // prevent double submit
  submitBtn.disabled = true;
  submitBtn.textContent = "Creating…";
});
</script>
{% endblock %}